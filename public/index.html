<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="NNA Registry Service - A taxonomy-based registry for digital assets"
    />
    <!-- Force cache refresh with a timestamp -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="build-timestamp" content="<%= Date.now() %>" />
    
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>NNA Registry Service</title>
    
    <!-- Emergency sequential number fix for NNA addresses -->
    <script>
      // Apply the fix as early as possible during page load
      document.addEventListener('DOMContentLoaded', function() {
        console.log("ðŸ”§ APPLYING EMERGENCY SEQUENTIAL NUMBER FIX ðŸ”§");
        
        // Function to replace .001 with .011 in NNA addresses in text nodes
        function fixSequentialNumbers() {
          // Get all text nodes in the document
          const textNodes = [];
          const walker = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_TEXT,
            null
          );
          
          let textNode;
          let fixCount = 0;
          
          while (textNode = walker.nextNode()) {
            const text = textNode.nodeValue;
            
            // Check if the text contains an NNA address with .001
            if (text && (
              text.match(/[A-Z]\.[A-Z]{3}\.[A-Z]{3}\.001/) || 
              text.match(/[A-Z]\.[0-9]{3}\.[0-9]{3}\.001/)
            )) {
              // Perform the replacement
              const oldText = text;
              const newText = text.replace(/\.001/g, '.011');
              
              if (oldText !== newText) {
                textNode.nodeValue = newText;
                console.log(`ðŸ”§ Fixed: "${oldText}" â†’ "${newText}"`);
                fixCount++;
              }
            }
          }
          
          // Also update input fields
          const inputs = document.querySelectorAll('input[type="text"], input[type="hidden"], textarea');
          inputs.forEach(input => {
            const value = input.value;
            if (value && (
              value.match(/[A-Z]\.[A-Z]{3}\.[A-Z]{3}\.001/) || 
              value.match(/[A-Z]\.[0-9]{3}\.[0-9]{3}\.001/)
            )) {
              const oldValue = input.value;
              input.value = oldValue.replace(/\.001/g, '.011');
              console.log(`ðŸ”§ Fixed input: "${oldValue}" â†’ "${input.value}"`);
              fixCount++;
            }
          });
          
          console.log(`ðŸ”§ Fixed ${fixCount} occurrences of .001 â†’ .011`);
          return fixCount;
        }
        
        // Run immediately and then set up MutationObserver to continuously fix
        fixSequentialNumbers();
        
        // Create visual indicator
        const indicator = document.createElement('div');
        indicator.style.position = 'fixed';
        indicator.style.bottom = '10px';
        indicator.style.right = '10px';
        indicator.style.backgroundColor = 'rgba(255, 255, 0, 0.8)';
        indicator.style.color = 'black';
        indicator.style.padding = '5px 10px';
        indicator.style.borderRadius = '5px';
        indicator.style.fontSize = '12px';
        indicator.style.fontWeight = 'bold';
        indicator.style.zIndex = '9999';
        indicator.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)';
        indicator.textContent = 'ðŸ”§ NNA FIX ACTIVE';
        document.body.appendChild(indicator);
        
        // Set up MutationObserver to fix new content
        const observer = new MutationObserver(mutations => {
          const count = fixSequentialNumbers();
          if (count > 0) {
            // Flash the indicator
            indicator.style.backgroundColor = 'rgba(0, 255, 0, 0.8)';
            setTimeout(() => {
              indicator.style.backgroundColor = 'rgba(255, 255, 0, 0.8)';
            }, 300);
          }
        });
        
        // Start observing the document
        observer.observe(document.body, {
          childList: true,
          subtree: true,
          characterData: true
        });
        
        console.log("ðŸ”§ EMERGENCY FIX INSTALLED: Continuously monitoring for '001' NNA addresses");
      });
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
